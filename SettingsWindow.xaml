<Window x:Class="TaskbarTextOverlayWpf.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="任务栏文本设置"
        Width="820" Height="640"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize">
    <Grid Margin="14">
        <!-- 行列定义 -->
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="120"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- 文本 -->
        <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Text="显示文本：" />
        <TextBox   Grid.Row="0" Grid.Column="1" Text="{Binding Text, UpdateSourceTrigger=PropertyChanged}" />

        <!-- 字体 -->
        <TextBlock Grid.Row="1" Grid.Column="0" VerticalAlignment="Center" Text="字体：" />
        <ComboBox  Grid.Row="1" Grid.Column="1" x:Name="FontCombo"
               SelectedValue="{Binding FontFamily, UpdateSourceTrigger=PropertyChanged}" />

        <!-- 字号/加粗 -->
        <TextBlock Grid.Row="2" Grid.Column="0" VerticalAlignment="Center" Text="字号：" />
        <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Margin="0,0,0,4">
            <Slider Width="260" Minimum="10" Maximum="64"
              Value="{Binding FontSize, UpdateSourceTrigger=PropertyChanged}"/>
            <TextBox Width="60" Margin="8,0,0,0"
               Text="{Binding FontSize, StringFormat=F0, UpdateSourceTrigger=PropertyChanged}"/>
            <CheckBox Content="加粗" Margin="12,0,0,0" IsChecked="{Binding IsBold}"/>
        </StackPanel>

        <!-- 颜色（文本框 + 按钮 + 预览块） -->
        <TextBlock Grid.Row="3" Grid.Column="0" VerticalAlignment="Center" Text="颜色(HEX)：" />
        <StackPanel Grid.Row="3" Grid.Column="1" Orientation="Horizontal">
            <TextBox x:Name="ColorTextBox" Width="160"
               Text="{Binding ForegroundHex, UpdateSourceTrigger=Explicit}"
               ToolTip="#RRGGBB 或 #AARRGGBB"
               LostFocus="ColorTextBox_LostFocus"/>
            <Button Content="选择…" Click="PickColor_Click" Margin="8,0,0,0"/>
            <Border Width="24" Height="24" Margin="8,0,0,0"
              BorderBrush="#40FFFFFF" BorderThickness="1"
              Background="{Binding ForegroundBrush}"/>
        </StackPanel>

        <!-- 对齐 -->
        <TextBlock Grid.Row="4" Grid.Column="0" VerticalAlignment="Center" Text="对齐：" />
        <ComboBox  Grid.Row="4" Grid.Column="1" x:Name="AlignCombo"
               SelectedItem="{Binding Alignment, UpdateSourceTrigger=PropertyChanged}" />

        <!-- 阴影 -->
        <TextBlock Grid.Row="5" Grid.Column="0" VerticalAlignment="Center" Text="阴影：" />
        <StackPanel Grid.Row="5" Grid.Column="1" Orientation="Horizontal">
            <TextBlock Text="不透明度" VerticalAlignment="Center"/>
            <Slider Width="160" Minimum="0" Maximum="1" SmallChange="0.05" TickFrequency="0.1"
              Value="{Binding ShadowOpacity, UpdateSourceTrigger=PropertyChanged}"
              Margin="10,0,0,0"/>
            <TextBlock Text="{Binding ShadowOpacity, StringFormat=F2}" Width="40" VerticalAlignment="Center" Margin="10,0,0,0"/>
            <TextBlock Text="模糊" Margin="10,0,0,0" VerticalAlignment="Center"/>
            <Slider Width="160" Minimum="0" Maximum="30"
              Value="{Binding ShadowBlur, UpdateSourceTrigger=PropertyChanged}"
              Margin="10,0,0,0"/>
            <TextBlock Text="{Binding ShadowBlur, StringFormat=F0}" Width="40" VerticalAlignment="Center" Margin="10,0,0,0"/>
        </StackPanel>

        <!-- 预览 -->
        <GroupBox Grid.Row="6" Grid.ColumnSpan="2" Header="预览" Margin="0,12,0,0">
            <Border Padding="10" Background="#202020">
                <TextBlock Text="{Binding Text}"
                   FontFamily="{Binding FontFamily}"
                   FontSize="{Binding FontSize}"
                   FontWeight="{Binding FontWeightValue}"
                   TextAlignment="{Binding Alignment}"
                   Foreground="{Binding ForegroundBrush}">
                    <TextBlock.Effect>
                        <DropShadowEffect ShadowDepth="0"
                              BlurRadius="{Binding ShadowBlur}"
                              Opacity="{Binding ShadowOpacity}"/>
                    </TextBlock.Effect>
                </TextBlock>
            </Border>
        </GroupBox>

        <!-- Python 配置（Spec v2） -->
        <GroupBox Grid.Row="8" Grid.ColumnSpan="2" Header="Python 生成（Spec v2）" Margin="0,12,0,0">
            <Grid Margin="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="160"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <CheckBox Grid.Row="0" Grid.Column="0" Content="启用 Python" IsChecked="{Binding UsePython}" />

                <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Orientation="Horizontal">
                    <TextBlock VerticalAlignment="Center" Text="Python 路径(可选):"/>
                    <TextBox Width="220" Text="{Binding PythonPath, UpdateSourceTrigger=PropertyChanged}" Margin="8,0,0,0"/>
                    <TextBlock VerticalAlignment="Center" Text="最小间隔(ms):" Margin="8,0,0,0"/>
                    <TextBox Width="80" Text="{Binding MinIntervalMs, UpdateSourceTrigger=PropertyChanged}" Margin="8,0,0,0"/>
                    <TextBlock VerticalAlignment="Center" Text="启动超时(ms):" Margin="8,0,0,0"/>
                    <TextBox Width="80" Text="{Binding StartTimeoutMs, UpdateSourceTrigger=PropertyChanged}" Margin="8,0,0,0"/>
                    <TextBlock VerticalAlignment="Center" Text="静默超时(ms):" Margin="8,0,0,0"/>
                    <TextBox Width="80" Text="{Binding InactivityTimeoutMs, UpdateSourceTrigger=PropertyChanged}" Margin="8,0,0,0"/>
                    <TextBlock VerticalAlignment="Center" Text="单帧最大字节:" Margin="8,0,0,0"/>
                    <TextBox Width="80" Text="{Binding MaxBytesPerFrame, UpdateSourceTrigger=PropertyChanged}" Margin="8,0,0,0"/>
                    <CheckBox Content="去重" IsChecked="{Binding Dedupe}" Margin="8,0,0,0"/>
                </StackPanel>

                <DockPanel Grid.Row="2" Grid.ColumnSpan="2">
                    <TextBlock Text="脚本：" DockPanel.Dock="Top"/>
                    <TextBox x:Name="PyCodeBox" FontFamily="Consolas" FontSize="13" AcceptsReturn="True"
                   VerticalScrollBarVisibility="Auto"
                   Text="{Binding PythonCode, UpdateSourceTrigger=PropertyChanged}"/>
                </DockPanel>
            </Grid>
        </GroupBox>

        <!-- 按钮 -->
        <StackPanel Grid.Row="9" Grid.ColumnSpan="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,10,0,0">
            <Button Width="110" Content="保存" Margin="0,0,10,0" Click="Save_Click"/>
            <Button Width="110" Content="关闭" Click="Close_Click"/>
        </StackPanel>
    </Grid>
</Window>
